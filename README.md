# aws-ec2-web-application

<!-- TABLE OF CONTENTS -->
<details open="open">
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
      <ul>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#installation">Installation</a></li>
      </ul>
    </li>
    <li><a href="#usage">Usage</a></li>
  </ol>
</details>



<!-- ABOUT THE PROJECT -->
## About The Project

This project is built to host a NGINX docker application in AWS EC2 instance.


### Built With

The project is built using,
* AWS resources
* Terraform
* Ansible


<!-- GETTING STARTED -->
## Getting Started

### Prerequisites

* Create a free tier AWS account.
* Create an IAM user with programmable access and make a note of the access and secret keys.

### Installation

1. Clone the repo
   ```sh
   git clone https://github.com/satishsnkr/terraform_ansible_docker_nginx.git
   ```
2. [Install Terraform](https://www.terraform.io/downloads.html)
3. [Install Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)



<!-- USAGE EXAMPLES -->
## Usage

Hosting this application involves three parts.

### Part 1: Setting up the AWS Infrastructure

The infrastructure is setup in AWS using Terraform.

1. After cloning the repository into your local folder , generate ssh key using ssh-keygen
2. id_rsa.pub will be generated at this location ~/.ssh/id_rsa.pub
3. You need 4 values before you can start 
    a. AWS ACCESS KEY ID
    b. AWS SECRET ACCESS KEY
    c. AWS location (ex: ap-southeast-2 )
    d. ssh key ( key from ~/.ssh/id_rsa.pub generated by above steps )
2. Run the following commands in order
    - terraform init
    - terraform plan
    - terraform apply

This will provision the required infrastructure and provides the EC2 instance public IP as the output.

### Part 2: Installing the application

The next step is to install the required softwares in the EC2 instance and deploy the NGINX application in docker. This is done using ansible.

1. Open the inventory.yml file under ansible directory and replace 0.0.0.0 with the public IP copied at the end of part 1. (or run the command " terraform output vm_public_ip |tr -d '"'  " to display the public ip on screen)

2. Run the ansible playbook using the below command
    - ansible-playbook -i inventory.yml application.yml

3. To check the resource stats go to below links

http://<public-ip>:8080/resource.html ( to Check the nginx stats)

4. Use below command to curl the REST API
curl http://<public-ip>:3000/resource

### Part 3: Tear down the application

Run the below command to tear down the application.

    - terrafrom destroy
